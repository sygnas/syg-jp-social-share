{"version":3,"file":"jp-social-share.min.js","sources":["../src/index.js"],"sourcesContent":["/**\r\n * 日本向けソーシャルシェアボタン\r\n *\r\n * @author   Hiroshi Fukuda <info.sygnas@gmail.com>\r\n * @license  MIT\r\n */\r\n\r\n/* global location */\r\n/* eslint no-restricted-globals: [\"off\", \"location\"] */\r\n/* eslint no-empty: [\"off\"] */\r\n/* eslint no-lone-blocks: [\"off\"] */\r\n\r\nconst SERVICE_TWITTER = 'twitter';\r\nconst SERVICE_FACEBOOK = 'facebook';\r\nconst SERVICE_LINE = 'line';\r\nconst SERVICE_FEEDLY = 'feedly';\r\nconst SERVICE_POCKET = 'pocket';\r\nconst SERVICE_HATEBU = 'hatebu';\r\nconst SERVICE_GOOGLE = 'google';\r\n\r\nconst defaults = {\r\n    // window.open() のオプション\r\n    window: {\r\n        width: 550,\r\n        height: 450,\r\n        personalbar: 0,\r\n        toolbar: 0,\r\n        scrollbars: 1,\r\n        resizable: 1\r\n    },\r\n    // シェア用URLのテンプレート\r\n    twitter: 'http://twitter.com/share?url={{URL}}&text={{MESSAGE}}&via={{ACCOUNT}}&related={{FOLLOW}}',\r\n    facebook: 'http://www.facebook.com/share.php?u={{URL}}',\r\n    line: 'line://msg/text/{{MESSAGE}} {{URL}}',\r\n    feedly: 'http://feedly.com/i/subscription/feed/{{URL}}',\r\n    pocket: 'http://getpocket.com/edit?url={{URL}}',\r\n    hatebu: '//b.hatena.ne.jp/add?mode=confirm&url={{URL}}&title={{MESSAGE}}',\r\n    google: 'https://plus.google.com/share?url={{URL}}'\r\n};\r\n\r\n/**\r\n * シェアボタンのリンクを設定する\r\n * @param {String} target 対象ボタンのセレクタ\r\n * @param {Object} options 新規ウィンドウのパラメータ（defaults参照）\r\n */\r\nexport default function (target, options) {\r\n    // 設定のマージ\r\n    const opt = Object.assign(defaults, options);\r\n\r\n    // クリック動作\r\n    get_node_array(document.querySelectorAll(target)).forEach((elm) => {\r\n        elm.addEventListener('click', (e) => {\r\n            // シェア用ウィンドウを開く\r\n            open_window(elm);\r\n            e.preventDefault();\r\n        });\r\n    });\r\n\r\n    /**\r\n     * シェア用ウィンドウを開く\r\n     * @param elm {Element} クリックしたエレメント\r\n     */\r\n    function open_window(elm) {\r\n        // エレメントからパラメータを取得\r\n        const service = elm.getAttribute('data-share-service');\r\n        const account = elm.getAttribute('data-share-account') || '';\r\n        const follow = elm.getAttribute('data-share-follow') || '';\r\n        const message = elm.getAttribute('data-share-message') || document.title;\r\n        const url = elm.getAttribute('data-share-url') || location.href;\r\n\r\n        // 存在しないサービスだったら抜ける\r\n        if (Object.keys(opt).indexOf(service) === -1) {\r\n            console.log(`${service} is not supported.`);\r\n            return;\r\n        }\r\n\r\n        // テンプレートからコンバート\r\n        const open_url = convert_open_url(\r\n            service, account,\r\n            follow, message, url\r\n        );\r\n\r\n        // LINEはアプリに飛ばす。それ以外はウィンドウを開く\r\n        if (service === 'line') {\r\n            window.location.href = open_url;\r\n        } else {\r\n            const window_opt = get_window_option(opt.window);\r\n            window.open(open_url, `share_${service}`, window_opt);\r\n        }\r\n    }\r\n    /**\r\n     * サービス毎のURLを取得\r\n     * パラメータによっては加工がされる\r\n     * @param service {String} ソーシャルサービス識別子\r\n     * @param account {String} ツイートに付けるRepleyアカウント\r\n     * @param follow {String} ツイート後に表示するフォロー候補アカウント\r\n     * @param message {String} メッセージ本文\r\n     * @param url {String} シェアURL\r\n     * @return {String} シェア窓オープンURL\r\n     */\r\n    function convert_open_url(service, account, follow, message, url) {\r\n        const eu = encodeURIComponent;\r\n        let open_url = opt[service];\r\n\r\n        // Twitterだけパラメータの内容によってURLが変わる\r\n        if (service === SERVICE_TWITTER) {\r\n            if (!account) open_url = open_url.replace('&via={{ACCOUNT}}', '');\r\n            if (!follow) open_url = open_url.replace('&related={{FOLLOW}}', '');\r\n        }\r\n\r\n        open_url = open_url.replace('{{ACCOUNT}}', eu(account));\r\n        open_url = open_url.replace('{{FOLLOW}}', eu(follow));\r\n        open_url = open_url.replace('{{MESSAGE}}', eu(message));\r\n        open_url = open_url.replace('{{URL}}', eu(url));\r\n\r\n        return open_url;\r\n    }\r\n}\r\n\r\n\r\n\r\n/**\r\n * Element.matches() polyfill\r\n */\r\nif (!Element.prototype.matches) {\r\n    Element.prototype.matches =\r\n        Element.prototype.matchesSelector ||\r\n        Element.prototype.mozMatchesSelector ||\r\n        Element.prototype.msMatchesSelector ||\r\n        Element.prototype.oMatchesSelector ||\r\n        Element.prototype.webkitMatchesSelector ||\r\n        function (s) {\r\n            const matches = (\r\n                this.document ||\r\n                this.ownerDocument)\r\n                .querySelectorAll(s);\r\n            let i = matches.length;\r\n            do {\r\n                i -= 1;\r\n            } while (i >= 0 && matches.item(i) !== this); {}\r\n            return i > -1;\r\n        };\r\n}\r\n\r\n/**\r\n * NodeListをArrayとして取り出す（IE対策）\r\n */\r\nfunction get_node_array(node_list) {\r\n    return Array.prototype.slice.call(node_list, 0);\r\n}\r\n\r\n/**\r\n * Windowパラメータ作成\r\n * @param opt {Object} ウィンドウパラメータ\r\n * @return {String} 新規ウィンドウのパラメータ文字列\r\n */\r\nfunction get_window_option(opt) {\r\n    const items = [];\r\n    Object.keys(opt).forEach((key) => {\r\n        items.push(`${key}=${opt[key]}`);\r\n    });\r\n    return items.join(',');\r\n}\r\n"],"names":["SERVICE_TWITTER","defaults","Element","prototype","matches","matchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector","s","this","document","ownerDocument","querySelectorAll","i","length","item","target","options","open_window","elm","service","getAttribute","account","follow","message","title","url","location","href","Object","keys","opt","indexOf","open_url","eu","encodeURIComponent","replace","convert_open_url","window_opt","items","forEach","key","push","join","get_window_option","window","open","log","assign","node_list","Array","slice","call","addEventListener","e","preventDefault"],"mappings":"kMAYA,IAAMA,EAAkB,UAQlBC,iBAGS,WACC,gBACK,UACJ,aACG,YACD,WAGN,oGACC,mDACJ,6CACE,uDACA,+CACA,yEACA,oDAuFPC,QAAQC,UAAUC,kBACXD,UAAUC,QACdF,QAAQC,UAAUE,iBAClBH,QAAQC,UAAUG,oBAClBJ,QAAQC,UAAUI,mBAClBL,QAAQC,UAAUK,kBAClBN,QAAQC,UAAUM,uBAClB,SAAUC,OACAN,GACFO,KAAKC,UACLD,KAAKE,eACJC,iBAAiBJ,GAClBK,EAAIX,EAAQY,aAEP,QACAD,GAAK,GAAKX,EAAQa,KAAKF,KAAOJ,MAAO,OACvCI,GAAK,IA/FT,SAAUG,EAAQC,YAiBpBC,EAAYC,OAEXC,EAAUD,EAAIE,aAAa,sBAC3BC,EAAUH,EAAIE,aAAa,uBAAyB,GACpDE,EAASJ,EAAIE,aAAa,sBAAwB,GAClDG,EAAUL,EAAIE,aAAa,uBAAyBX,SAASe,MAC7DC,EAAMP,EAAIE,aAAa,mBAAqBM,SAASC,SAGhB,IAAvCC,OAAOC,KAAKC,GAAKC,QAAQZ,QAMvBa,WAuBgBb,EAASE,EAASC,EAAQC,EAASE,OACnDQ,EAAKC,mBACPF,EAAWF,EAAIX,UAGfA,IAAYtB,IACPwB,IAASW,EAAWA,EAASG,QAAQ,mBAAoB,KACzDb,IAAQU,EAAWA,EAASG,QAAQ,sBAAuB,QAGzDH,EAASG,QAAQ,cAAeF,EAAGZ,MACnCW,EAASG,QAAQ,aAAcF,EAAGX,MAClCU,EAASG,QAAQ,cAAeF,EAAGV,MACnCS,EAASG,QAAQ,UAAWF,EAAGR,IApCzBW,CACbjB,EAASE,EACTC,EAAQC,EAASE,MAIL,SAAZN,SACOO,SAASC,KAAOK,MACpB,KACGK,EAsElB,SAA2BP,OACjBQ,mBACCT,KAAKC,GAAKS,QAAQ,SAACC,KAChBC,KAAQD,MAAOV,EAAIU,MAEtBF,EAAMI,KAAK,KA3ESC,CAAkBb,EAAIc,eAClCC,KAAKb,WAAmBb,EAAWkB,iBAflCS,IAAO3B,4BAzBjBW,EAAMF,OAAOmB,OAAOjD,EAAUkB,IAoGxC,SAAwBgC,UACbC,MAAMjD,UAAUkD,MAAMC,KAAKH,EAAW,KAlG9BvC,SAASE,iBAAiBI,IAASwB,QAAQ,SAACrB,KACnDkC,iBAAiB,QAAS,SAACC,KAEfnC,KACVoC"}