{"version":3,"file":"jp-social-share.js","sources":["../src/index.ts"],"sourcesContent":["/**\r\n * 日本向けソーシャルシェアボタン\r\n *\r\n * @author   Hiroshi Fukuda <info.sygnas@gmail.com>\r\n * @license  MIT\r\n */\r\n\r\nimport { TService, TOption, TOptionWindow, TOptionWindowParam } from \"./types\";\r\n\r\nclass JpSocialShare {\r\n  // サービス名識別子\r\n  static SERVICES: { [key: string]: TService } = {\r\n    TWITTER: 'twitter',\r\n    FACEBOOK: 'facebook',\r\n    LINE: 'line',\r\n    FEEDLY: 'feedly',\r\n    POCKET: 'pocket',\r\n    HATEBU: 'hatebu',\r\n  };\r\n\r\n  static opt: TOption;\r\n\r\n  private static defaults: TOption = {\r\n    // window.open() のオプション\r\n    window: {\r\n      width: 550,\r\n      height: 450,\r\n      personalbar: 0,\r\n      toolbar: 0,\r\n      scrollbars: 1,\r\n      resizable: 1,\r\n    },\r\n    // シェア用URLのテンプレート\r\n    services: {\r\n      twitter:\r\n        'http://twitter.com/share?url={{URL}}&text={{MESSAGE}}&via={{ACCOUNT}}&related={{FOLLOW}}',\r\n      facebook: 'http://www.facebook.com/share.php?u={{URL}}',\r\n      line: 'line://msg/text/{{MESSAGE}} {{URL}}',\r\n      feedly: 'http://feedly.com/i/subscription/feed/{{URL}}',\r\n      pocket: 'http://getpocket.com/edit?url={{URL}}',\r\n      hatebu: '//b.hatena.ne.jp/add?mode=confirm&url={{URL}}&title={{MESSAGE}}',\r\n    },\r\n  };\r\n\r\n  ////////////////////////\r\n  ////////////////////////\r\n\r\n  /**\r\n   * シェアボタンのリンクを設定する\r\n   * @param {String} target 対象ボタンのセレクタ\r\n   * @param {Object} option 新規ウィンドウのパラメータ（defaults参照）\r\n   */\r\n  static setShareButton(target: string, option: TOption = {}): void {\r\n    // 設定のマージ\r\n    this.opt = Object.assign(this.defaults, option);\r\n\r\n    // クリックイベントを設定\r\n    this.getNodeArray(document.querySelectorAll<HTMLElement>(target)).forEach(\r\n      (elm) => {\r\n        elm.addEventListener('click', (ev: Event) => {\r\n          const elm = ev.currentTarget as HTMLElement;\r\n          this.openShareWindowWithElement(elm);\r\n          ev.preventDefault();\r\n        });\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * エレメントから情報を取得してシェア用ウィンドウを開く\r\n   */\r\n  static openShareWindowWithElement(elm: HTMLElement){\r\n    // エレメントからパラメータを取得\r\n    const service: TService = elm.getAttribute('data-share-service') as TService;\r\n    const url: string = elm.getAttribute('data-share-url') || '';\r\n    const message: string = elm.getAttribute('data-share-message') || document.title;\r\n    const account: string = elm.getAttribute('data-share-account') || '';\r\n    const follow: string = elm.getAttribute('data-share-follow') || '';\r\n\r\n    // シェア用ウィンドウを開く\r\n    this.openShareWindow(service, url, message, account, follow);\r\n  }\r\n\r\n  /**\r\n   * シェア用ウィンドウを開く\r\n   * @param service {String} ソーシャルサービス識別子\r\n   * @param url {String} シェアURL\r\n   * @param message {String} メッセージ本文\r\n   * @param account {String} ツイートに付けるRepleyアカウント\r\n   * @param follow {String} ツイート後に表示するフォロー候補アカウント\r\n   */\r\n  static openShareWindow(\r\n    service: TService,\r\n    url: string = '',\r\n    message: string = '',\r\n    account: string = '',\r\n    follow: string = ''\r\n  ): void {\r\n    // 存在しないサービスだったらエラー\r\n    if (\r\n      this.opt.services &&\r\n      Object.keys(this.opt.services).indexOf(service) === -1\r\n    ) {\r\n      console.log(`${service} is not supported.`);\r\n      return;\r\n    }\r\n\r\n    // テンプレートからコンバート\r\n    const openUrl: string = this.convertOpenUrl(\r\n      service,\r\n      url,\r\n      message,\r\n      account,\r\n      follow\r\n    );\r\n\r\n    // LINEはアプリに飛ばす。それ以外はウィンドウを開く\r\n    if (service === this.SERVICES.LINE) {\r\n      window.location.href = openUrl;\r\n    } else if (this.opt.window) {\r\n      const windowOption = this.getWindowOption(this.opt.window);\r\n      window.open(openUrl, `share_${service}`, windowOption);\r\n    } else {\r\n      console.log('Window option is not defined.');\r\n      return;\r\n    }\r\n  }\r\n\r\n  ////////////////////////\r\n  ////////////////////////\r\n\r\n  /**\r\n   * サービス毎のURLを取得\r\n   * パラメータによっては加工がされる\r\n   * @param service {String} ソーシャルサービス識別子\r\n   * @param url {String} シェアURL\r\n   * @param message {String} メッセージ本文\r\n   * @param account {String} ツイートに付けるRepleyアカウント\r\n   * @param follow {String} ツイート後に表示するフォロー候補アカウント\r\n   * @return {String} シェア窓オープンURL\r\n   */\r\n  private static convertOpenUrl(\r\n    service: TService,\r\n    url: string = '',\r\n    message: string = '',\r\n    account: string = '',\r\n    follow: string = ''\r\n  ): string {\r\n    const eu = encodeURIComponent;\r\n\r\n    const shareUrl = url || location.href;\r\n    let openUrl = this.opt.services ? this.opt.services[service] : \"\";\r\n\r\n    if (!openUrl) {\r\n      console.log(`${service} is not supported.`);\r\n      return \"\";\r\n    }\r\n\r\n    // Twitterだけパラメータの内容によってURLが変わる\r\n    if (service === this.SERVICES.TWITTER) {\r\n      if (!account) openUrl = openUrl.replace(\"&via={{ACCOUNT}}\", \"\");\r\n      if (!follow) openUrl = openUrl.replace(\"&related={{FOLLOW}}\", \"\");\r\n    }\r\n\r\n\r\n    openUrl = openUrl.replace(\"{{ACCOUNT}}\", eu(account));\r\n    openUrl = openUrl.replace(\"{{FOLLOW}}\", eu(follow));\r\n    openUrl = openUrl.replace(\"{{MESSAGE}}\", eu(message));\r\n    openUrl = openUrl.replace(\"{{URL}}\", eu(shareUrl));\r\n\r\n    return openUrl;\r\n  }\r\n\r\n  /**\r\n   * NodeListをArrayとして取り出す（IE対策）\r\n   */\r\n  private static getNodeArray(nodeList: NodeList) {\r\n    return Array.prototype.slice.call(nodeList, 0);\r\n  }\r\n\r\n  /**\r\n   * Windowパラメータ作成\r\n   * @param opt {Object} ウィンドウパラメータ\r\n   * @return {String} 新規ウィンドウのパラメータ文字列\r\n   */\r\n  private static getWindowOption(opt: TOptionWindow): string {\r\n    const items: string[] = [];\r\n\r\n    Object.keys(opt).forEach((key) => {\r\n      items.push(`${key}=${opt[key as TOptionWindowParam]}`);\r\n    });\r\n    return items.join(\",\");\r\n  }\r\n}\r\n\r\nexport default JpSocialShare;\r\n"],"names":["JpSocialShare","target","option","opt","Object","assign","defaults","getNodeArray","document","querySelectorAll","forEach","elm","addEventListener","ev","currentTarget","openShareWindowWithElement","preventDefault","service","getAttribute","url","message","title","account","follow","openShareWindow","services","keys","indexOf","console","log","openUrl","convertOpenUrl","SERVICES","LINE","window","location","href","windowOption","getWindowOption","open","eu","encodeURIComponent","shareUrl","TWITTER","replace","nodeList","Array","prototype","slice","call","items","key","push","join","FACEBOOK","FEEDLY","POCKET","HATEBU","width","height","personalbar","toolbar","scrollbars","resizable","twitter","facebook","line","feedly","pocket","hatebu"],"mappings":"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"}