{"version":3,"file":"jp-social-share.js","sources":["../src/index.js"],"sourcesContent":["/**\r\n * 日本向けソーシャルシェアボタン\r\n *\r\n * @author   Hiroshi Fukuda <info.sygnas@gmail.com>\r\n * @license  MIT\r\n */\r\n\r\n/* global location */\r\n/* eslint no-restricted-globals: [\"off\", \"location\"] */\r\n/* eslint no-empty: [\"off\"] */\r\n/* eslint no-lone-blocks: [\"off\"] */\r\n\r\nconst SERVICE_TWITTER = 'twitter';\r\nconst SERVICE_FACEBOOK = 'facebook';\r\nconst SERVICE_LINE = 'line';\r\nconst SERVICE_FEEDLY = 'feedly';\r\nconst SERVICE_POCKET = 'pocket';\r\nconst SERVICE_HATEBU = 'hatebu';\r\nconst SERVICE_GOOGLE = 'google';\r\n\r\nconst defaults = {\r\n    // window.open() のオプション\r\n    window: {\r\n        width: 550,\r\n        height: 450,\r\n        personalbar: 0,\r\n        toolbar: 0,\r\n        scrollbars: 1,\r\n        resizable: 1\r\n    },\r\n    // シェア用URLのテンプレート\r\n    twitter: 'http://twitter.com/share?url={{URL}}&text={{MESSAGE}}&via={{ACCOUNT}}&related={{FOLLOW}}',\r\n    facebook: 'http://www.facebook.com/share.php?u={{URL}}',\r\n    line: 'line://msg/text/{{MESSAGE}} {{URL}}',\r\n    feedly: 'http://feedly.com/i/subscription/feed/{{URL}}',\r\n    pocket: 'http://getpocket.com/edit?url={{URL}}',\r\n    hatebu: '//b.hatena.ne.jp/add?mode=confirm&url={{URL}}&title={{MESSAGE}}',\r\n    google: 'https://plus.google.com/share?url={{URL}}'\r\n};\r\n\r\n/**\r\n * シェアボタンのリンクを設定する\r\n * @param {String} target 対象ボタンのセレクタ\r\n * @param {Object} options 新規ウィンドウのパラメータ（defaults参照）\r\n */\r\nexport default function (target, options) {\r\n    // 設定のマージ\r\n    const opt = Object.assign(defaults, options);\r\n\r\n    // クリック動作\r\n    get_node_array(document.querySelectorAll(target)).forEach((elm) => {\r\n        elm.addEventListener('click', (e) => {\r\n            // シェア用ウィンドウを開く\r\n            open_window(elm);\r\n            e.preventDefault();\r\n        });\r\n    });\r\n\r\n    /**\r\n     * シェア用ウィンドウを開く\r\n     * @param elm {Element} クリックしたエレメント\r\n     */\r\n    function open_window(elm) {\r\n        // エレメントからパラメータを取得\r\n        const service = elm.getAttribute('data-share-service');\r\n        const account = elm.getAttribute('data-share-account') || '';\r\n        const follow = elm.getAttribute('data-share-follow') || '';\r\n        const message = elm.getAttribute('data-share-message') || document.title;\r\n        const url = elm.getAttribute('data-share-url') || location.href;\r\n\r\n        // 存在しないサービスだったら抜ける\r\n        if (Object.keys(opt).indexOf(service) === -1) {\r\n            console.log(`${service} is not supported.`);\r\n            return;\r\n        }\r\n\r\n        // テンプレートからコンバート\r\n        const open_url = convert_open_url(\r\n            service, account,\r\n            follow, message, url\r\n        );\r\n\r\n        // LINEはアプリに飛ばす。それ以外はウィンドウを開く\r\n        if (service === 'line') {\r\n            window.location.href = open_url;\r\n        } else {\r\n            const window_opt = get_window_option(opt.window);\r\n            window.open(open_url, `share_${service}`, window_opt);\r\n        }\r\n    }\r\n    /**\r\n     * サービス毎のURLを取得\r\n     * パラメータによっては加工がされる\r\n     * @param service {String} ソーシャルサービス識別子\r\n     * @param account {String} ツイートに付けるRepleyアカウント\r\n     * @param follow {String} ツイート後に表示するフォロー候補アカウント\r\n     * @param message {String} メッセージ本文\r\n     * @param url {String} シェアURL\r\n     * @return {String} シェア窓オープンURL\r\n     */\r\n    function convert_open_url(service, account, follow, message, url) {\r\n        const eu = encodeURIComponent;\r\n        let open_url = opt[service];\r\n\r\n        // Twitterだけパラメータの内容によってURLが変わる\r\n        if (service === SERVICE_TWITTER) {\r\n            if (!account) open_url = open_url.replace('&via={{ACCOUNT}}', '');\r\n            if (!follow) open_url = open_url.replace('&related={{FOLLOW}}', '');\r\n        }\r\n\r\n        open_url = open_url.replace('{{ACCOUNT}}', eu(account));\r\n        open_url = open_url.replace('{{FOLLOW}}', eu(follow));\r\n        open_url = open_url.replace('{{MESSAGE}}', eu(message));\r\n        open_url = open_url.replace('{{URL}}', eu(url));\r\n\r\n        return open_url;\r\n    }\r\n}\r\n\r\n\r\n\r\n/**\r\n * Element.matches() polyfill\r\n */\r\nif (!Element.prototype.matches) {\r\n    Element.prototype.matches =\r\n        Element.prototype.matchesSelector ||\r\n        Element.prototype.mozMatchesSelector ||\r\n        Element.prototype.msMatchesSelector ||\r\n        Element.prototype.oMatchesSelector ||\r\n        Element.prototype.webkitMatchesSelector ||\r\n        function (s) {\r\n            const matches = (\r\n                this.document ||\r\n                this.ownerDocument)\r\n                .querySelectorAll(s);\r\n            let i = matches.length;\r\n            do {\r\n                i -= 1;\r\n            } while (i >= 0 && matches.item(i) !== this); {}\r\n            return i > -1;\r\n        };\r\n}\r\n\r\n/**\r\n * NodeListをArrayとして取り出す（IE対策）\r\n */\r\nfunction get_node_array(node_list) {\r\n    return Array.prototype.slice.call(node_list, 0);\r\n}\r\n\r\n/**\r\n * Windowパラメータ作成\r\n * @param opt {Object} ウィンドウパラメータ\r\n * @return {String} 新規ウィンドウのパラメータ文字列\r\n */\r\nfunction get_window_option(opt) {\r\n    const items = [];\r\n    Object.keys(opt).forEach((key) => {\r\n        items.push(`${key}=${opt[key]}`);\r\n    });\r\n    return items.join(',');\r\n}\r\n"],"names":["SERVICE_TWITTER","defaults","target","options","opt","Object","assign","document","querySelectorAll","forEach","elm","addEventListener","e","preventDefault","open_window","service","getAttribute","account","follow","message","title","url","location","href","keys","indexOf","log","open_url","convert_open_url","window_opt","get_window_option","window","open","eu","encodeURIComponent","replace","Element","prototype","matches","matchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector","s","ownerDocument","i","length","item","get_node_array","node_list","Array","slice","call","items","key","push","join"],"mappings":"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"}